<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>GapGPT Ultra Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  font-family:sans-serif;
  background:linear-gradient(135deg,#1e1e2f,#2a2a45);
  display:flex;
  flex-direction:column;
  height:100vh;
  color:white;
  overflow:hidden;
}
#chat{
  flex:1;
  padding:12px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
}
.message{
  max-width:75%;
  padding:10px 14px;
  border-radius:16px;
  margin:6px 0;
  word-wrap:break-word;
  opacity:0;
  transform:translateY(20px);
  transition:all 0.4s ease;
  position:relative;
}
.user{
  background:#4c6ef5;
  align-self:flex-end;
  box-shadow:0 4px 12px rgba(76,110,245,0.5);
}
.bot{
  background:#f59f00;
  align-self:flex-start;
  box-shadow:0 4px 12px rgba(245,159,0,0.5);
}
#inputArea{
  display:flex;
  padding:10px;
  background:rgba(40,40,60,0.9);
  backdrop-filter:blur(6px);
}
#inputArea input{
  flex:1;
  padding:12px;
  border-radius:12px;
  border:none;
  outline:none;
  font-size:16px;
  background:rgba(255,255,255,0.1);
  color:white;
}
#inputArea input::placeholder{
  color:#ccc;
}
#inputArea button{
  padding:12px 18px;
  margin-left:6px;
  border:none;
  border-radius:12px;
  background:#4c6ef5;
  color:white;
  font-weight:bold;
  cursor:pointer;
  transition:all 0.3s ease;
}
#inputArea button:hover{
  background:#3b5bdb;
}
.typing{
  font-style:italic;
  opacity:0.6;
}
</style>
</head>
<body>

<div id="chat"></div>

<div id="inputArea">
  <input type="text" id="input" placeholder="پیام خود را تایپ کن و Enter بزن...">
  <button onclick="sendMessage()">Send</button>
</div>

<script>
const chat=document.getElementById("chat");
const input=document.getElementById("input");

// API
const API_KEY="sk-MeFUOowj5yILENmQD3kGkaowLeRCiwm7cbnLQSfbZjb9RT5d";
const BASE_URL="https://api.gapgpt.app/v1";

// Add message
function addMessage(text,sender){
  const div=document.createElement("div");
  div.className="message "+sender;
  div.innerText=text;
  chat.appendChild(div);
  setTimeout(()=>{
    div.style.opacity=1;
    div.style.transform="translateY(0)";
  },50);
  chat.scrollTop=chat.scrollHeight;
  return div;
}

// Typing animation
async function typeMessage(div,text){
  div.innerText="";
  for(let i=0;i<text.length;i++){
    div.innerText+=text[i];
    await new Promise(r=>setTimeout(r,18)); // typing speed
    chat.scrollTop=chat.scrollHeight;
  }
}

async function sendMessage(){
  const message=input.value.trim();
  if(!message) return;
  addMessage(message,"user");
  input.value="";

  const typingDiv = addMessage("در حال تایپ...","bot");
  typingDiv.classList.add("typing");

  try{
    const res=await fetch(BASE_URL+"/chat/completions",{
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        "Authorization":"Bearer "+API_KEY
      },
      body:JSON.stringify({
        model:"gapgpt",
        messages:[{role:"user",content:message}]
      })
    });
    const data=await res.json();
    const botMessage = data.choices && data.choices[0].message.content || "خطا در پاسخ";

    // remove typing
    typingDiv.remove();
    const botDiv = addMessage("","bot");
    await typeMessage(botDiv,botMessage);
  }catch(err){
    console.error(err);
    typingDiv.innerText="خطا در اتصال به API";
  }
}

// Enter key support
input.addEventListener("keydown",function(e){
  if(e.key==="Enter"){ sendMessage(); }
});
</script>

</body>
</html>
