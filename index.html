<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>MoonAI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:sans-serif;background:#0f172a;color:white;display:flex;flex-direction:column;height:100vh;}
header{text-align:center;padding:15px;font-size:22px;background:#1e293b;}
#chat{flex:1;padding:10px;overflow-y:auto;display:flex;flex-direction:column;}
.message{max-width:80%;padding:8px 12px;border-radius:12px;margin:6px 0;word-wrap:break-word;}
.user{background:#2563eb;align-self:flex-end;}
.bot{background:#9333ea;align-self:flex-start;}
#inputArea{display:flex;padding:10px;background:#1e293b;}
#inputArea input{flex:1;padding:10px;border:none;border-radius:8px;outline:none;}
#inputArea button{padding:10px 15px;margin-left:5px;border:none;border-radius:8px;background:#2563eb;color:white;cursor:pointer;}
#clearBtn{background:#dc2626;}
</style>
</head>
<body>

<header>ðŸŒ™ MoonAI</header>

<div id="chat"></div>

<div id="inputArea">
  <input id="input" placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³...">
  <button onclick="sendMessage()">Ø§Ø±Ø³Ø§Ù„</button>
  <button id="clearBtn" onclick="clearChat()">Ù¾Ø§Ú©</button>
</div>

<script>
const chat=document.getElementById("chat");
const input=document.getElementById("input");

// ðŸ”¹ Ù„ÛŒÙ†Ú© Ø¨Ú©â€ŒØ§Ù†Ø¯ Render Ø®ÙˆØ¯Øª
const SERVER_URL="https://moonai.onrender.com/chat";

// Ø¢Ø±Ø§ÛŒÙ‡ Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
let messages = JSON.parse(localStorage.getItem("moonai_chat")) || [];

// Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø² Ø´Ø¯Ù† ØµÙØ­Ù‡
function loadMessages(){
  messages.forEach(msg=>addMessageToUI(msg.text,msg.sender));
}

function saveMessages(){
  localStorage.setItem("moonai_chat",JSON.stringify(messages));
}

function addMessageToUI(text,sender){
  const div=document.createElement("div");
  div.className="message "+sender;
  div.innerText=text;
  chat.appendChild(div);
  chat.scrollTop=chat.scrollHeight;
}

function addMessage(text,sender){
  messages.push({text,sender});
  saveMessages();
  addMessageToUI(text,sender);
}

async function sendMessage(){
  const message=input.value.trim();
  if(!message) return;

  addMessage(message,"user");
  input.value="";

  addMessage("Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø§Ø³Ø®...","bot");

  try{
    const res=await fetch(SERVER_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({message})
    });
    const data=await res.json();

    // Ø­Ø°Ù Ù¾ÛŒØ§Ù… "Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø§Ø³Ø®..."
    messages.pop();
    chat.removeChild(chat.lastChild);

    addMessage(data.reply,"bot");
  }catch{
    messages.pop();
    chat.removeChild(chat.lastChild);
    addMessage("Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ MoonAI","bot");
  }
}

function clearChat(){
  localStorage.removeItem("moonai_chat");
  messages=[];
  chat.innerHTML="";
}

input.addEventListener("keydown",e=>{if(e.key==="Enter") sendMessage();});

loadMessages();
</script>

</body>
</html>
